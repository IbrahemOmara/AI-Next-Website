import{k as P,r as l,u as A,d as q,j as e,e as I,B as C,h as r,f as j,g as k}from"./index-rN5JyR99.js";function E(){const d=P(),[o,c]=l.useState(d.toPrice-"0"),[n,m]=l.useState([]),[u,h]=l.useState(!1),[b,x]=l.useState(!1),[L,B]=l.useState(0),[N,p]=l.useState("not-allowed");let v=A();const[$,f]=l.useState("d-none");async function g(s){try{const t=await j.get(`${k}/User/CheckTokenStatus?tokenNumber=${s}`),{data:a}=t;return a.isUsed!==!1?(p("not-allowed"),f("d-block"),r.error("Token not Valid"),{isValid:!1}):(p(""),f("d-none"),r.success("Ok Valid Token"),{isValid:!0,value:a.value})}catch(t){return console.log(t.response.data),r.error(t.response.data),{isValid:!1,error:t.response.data}}}function w(s){j.post(`${k}/User/BuyPackages`,s).then(({data:t})=>{v("/pay-success")}).catch(t=>{})}let i=q({initialValues:{tokens:n,packagesIds:[],customerAttributeId:0},onSubmit:s=>{const t=JSON.parse(localStorage.getItem("cart_packages"));s.packagesIds=t.map(a=>a.id),s.tokens=n.map(a=>a.token),s.customerAttributeId=JSON.parse(localStorage.dataAuth).customerAttributeId,w(s)}});const y=async s=>{if(h(!0),s)if(n.find(a=>a.token===s))r.error("Token already added");else{const a=await g(s);a.isValid&&(m([...n,{token:s,value:a.value}]),c(o-a.value),console.log(o-a.value),o-a.value||x(!0))}else r.error("Enter valid token");h(!1)},T=async s=>{m(n.filter(t=>t.token!==s.token)),c(o+s.value),console.log(o),o||x(!0)},[S,V]=l.useState(!0);return l.useEffect(()=>{setTimeout(()=>V(!1),2e3)},[]),S?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("section",{className:"pay",id:"pay",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row ",children:e.jsx("div",{className:"col-md-6 col-lg-5 m-auto ",children:e.jsxs("div",{className:"box-pay ",children:[e.jsxs("div",{className:"head-pay d-flex align-items-center gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2.5em",height:"2.5em",viewBox:"0 0 2048 2048",children:e.jsx("path",{fill:"currentColor",d:"M1888 256q33 0 62 12t51 35t34 51t13 62v1088q0 33-12 62t-35 51t-51 34t-62 13H160q-33 0-62-12t-51-35t-34-51t-13-62V416q0-33 12-62t35-51t51-34t62-13zM160 384q-14 0-23 9t-9 23v224h1792V416q0-14-9-23t-23-9zm1728 1152q14 0 23-9t9-23V768H128v736q0 14 9 23t23 9zm-480-384h256v128h-256z"})}),e.jsx("h1",{className:"text-main-2 my-fw-bold text-center",children:"Pay by Token"})]}),e.jsxs("form",{onSubmit:i.handleSubmit,children:[e.jsx("div",{className:"row mt-4",children:e.jsxs("div",{className:"col-12",children:[e.jsx("h5",{className:"fw-bold",children:"Total of the Order"}),e.jsxs("div",{className:"total-ordar border rounded-2 ps-2 py-2 fw-bold",children:["$",d.toPrice]})]})}),e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"token",children:[e.jsx("label",{htmlFor:"token",className:"form-label fs-5 fw-bold",children:"Token"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{onChange:i.handleChange,type:"text",className:"form-control my-input py-2 border-0",name:"tokens",id:"tokens",placeholder:""}),e.jsx("button",{disabled:u,type:"button",onClick:()=>y(i.values.tokens),className:"btn text-white bg-main-color-3 position-absolute end-0 top-0 h-100 ",children:u?e.jsx(C,{}):e.jsx("i",{className:"fa-solid fa-plus"})})]})]})})}),e.jsxs("div",{className:"row mt-4",children:[e.jsx("div",{className:"col-12",children:n.length?e.jsx("div",{className:" border rounded-2 ps-2 py-2 fw-bold d-flex gap-3 flex-wrap",children:n.map(s=>e.jsxs("div",{className:" d-flex gap-2",children:[e.jsx("p",{className:"m-0",children:s.token}),e.jsxs("button",{onClick:()=>T(s),className:"btn p-0 text-danger",children:[e.jsx("i",{className:"fa-solid fa-close"})," "]})]},s.token))}):""}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:" border rounded-2 ps-2 py-2 fw-bold d-flex gap-3 flex-wrap mt-2",children:[e.jsxs("p",{className:"fw-medium m-0 text-just",children:["Your Tokens value : ",e.jsx("span",{className:"fw-bold",children:d.toPrice-"0"-o})]}),e.jsxs("p",{className:"fw-medium m-0 text-just",children:["Remaining value : ",e.jsx("span",{className:"fw-bold",children:o})]})]})})]}),e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:`button-pay ${N}`,children:e.jsx("button",{disabled:!b,type:"submit",className:"w-100 btn btn-pay fw-bolder fs-5 ",children:"Pay"})})})})]})]})})})})})})}export{E as default};
